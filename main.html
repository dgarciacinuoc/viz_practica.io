<html>
    <head>
        <script src="./engine/viz_engine.js"></script>
        <script src="./crime_dics.js"></script>

        <script>
                const json_2023 = 'https://data.lacity.org/resource/2nrs-mtv8.json'
                const json_former = 'https://data.lacity.org/api/views/63jg-8b9z/rows.json'
                let json = [];
                async function loadJSON(url, limit, offset) {
                    let buffer;
                    offset = offset || 0;
                    limit = limit || 10000;
                    url = url + '?$limit=' + limit + '&$offset=' + offset;
                    const response = await fetch(url)
                        .then(response => response.json())
                        .then(data => {
                             buffer = data;
                        })
                    for(let i=0; i < buffer.length; i++){
                        json.push([
                            buffer[i].area,
                            buffer[i].crm_cd,
                            buffer[i].date_occ.substr(0,10),
                            buffer[i].time_occ,
                            buffer[i].vict_age,
                            buffer[i].vict_descent,
                            buffer[i].vict_sex,
                            buffer[i].weapon_used_cd
                        ])
                    }   
                }
                
                loadJSON(json_2023, 10000, 650000);
        </script>
    </head>
    <body>
        <script>
            /*** TESTS **/
            let w = new WaffleChart('w', 2, 5);

            let t = new TreeMap('t');

            let s1 = new TreeMapSuperNode('s1');
            t.push(s1);


            let n1 = new TreeMapNode('1', 1); 
            let n2 = new TreeMapNode('2', 50);
            let n3 = new TreeMapNode('3', 7); 

            s1.push(n1);
            s1.push(n2);
            s1.push(n3);

            let labels = ['hipanic', 'black', 'chinese', 'vietnamese', 'peruvian', 'catalans'];
            let values = [10, 34, 2, 5, 3, 6];

            let icon_svg = `  <g viewBox="0 0 232 613">
                                    <circle class="cls-1" cx="117" cy="44" r="44"/>
                                    <path class="cls-1" d="M116.41,108.98h67.89c3.54.27,23.19,2.14,36.71,19.02,9.3,11.62,10.71,24.12,11,29v210.87c-1.53,11.09-10.54,19.48-21,20.13-11.72.73-22.66-8.41-24-21,.33-63,.67-126,1-189-.07-3.94-3.31-7.04-7-7-3.37.04-6.36,2.69-6.8,6.25v411.83c-.78,12.33-11.11,21.95-23.2,21.92-11.71-.03-21.77-9.11-23-21-.33-71.67-.67-143.33-1-215-2.36-4.46-7.04-7.19-12-7-4.62.18-8.82,2.86-11,7v215.41c-.3,12.51-10.64,22.59-23,22.59-12.15,0-22.39-9.72-23-22V171.48c-1.1-2.91-3.98-4.74-7-4.48-2.8.24-5.21,2.23-6,5v198.97c-2.87,9.95-11.88,16.87-22,17.03-10.74.17-20.39-7.3-23-18v-218.47c.47-3.84,2.67-17.99,15-29.53,12.12-11.35,26.08-12.74,30-13,23.8,0,47.6-.02,71.41-.02Z"/>
                             </g>
                            `

            let icon = new Icon(icon_svg);

            let i = new IconGraph('i', icon, labels, values);




        </script>
    </body>
    </body>
</html>